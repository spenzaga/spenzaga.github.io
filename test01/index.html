<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-correct {
            animation: pulseCorrect 0.6s ease-in-out;
        }
        @keyframes pulseCorrect {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); background-color: #10b981; }
            100% { transform: scale(1); }
        }
        .shake-wrong {
            animation: shakeWrong 0.6s ease-in-out;
        }
        @keyframes shakeWrong {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 font-sans">
    <div class="min-h-full flex items-center justify-center p-4">
        <div class="w-full max-w-2xl">
            <!-- Loading Screen -->
            <div id="loadingScreen" class="bg-white rounded-2xl shadow-2xl p-8 text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"></div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Memuat Kuis...</h2>
                <p class="text-gray-600">Mengambil data dari Google Sheet</p>
            </div>

            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="bg-white rounded-2xl shadow-2xl p-8 text-center hidden">
                <div class="mb-6">
                    <div class="w-20 h-20 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-3xl">üß†</span>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Kuis Interaktif</h1>
                    <p class="text-gray-600">Uji pengetahuan Anda dengan kuis yang menarik!</p>
                </div>
                <div class="bg-gray-50 rounded-xl p-4 mb-6">
                    <p class="text-sm text-gray-700 mb-2">üìä <span id="totalQuestions" class="font-semibold">0</span> pertanyaan tersedia</p>
                    <p class="text-sm text-gray-700">‚è±Ô∏è Tidak ada batas waktu</p>
                </div>
                <button id="startQuiz" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-8 rounded-xl transition-all duration-300 transform hover:scale-105">
                    Mulai Kuis
                </button>
            </div>

            <!-- Quiz Screen -->
            <div id="quizScreen" class="bg-white rounded-2xl shadow-2xl p-8 hidden">
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-sm font-medium text-gray-500">Pertanyaan <span id="currentQuestion">1</span> dari <span id="totalQuestionsQuiz">0</span></span>
                        <span class="text-sm font-medium text-purple-600">Skor: <span id="currentScore">0</span></span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progressBar" class="bg-gradient-to-r from-purple-600 to-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>

                <div class="mb-8">
                    <h2 id="questionText" class="text-xl font-bold text-gray-800 mb-6 leading-relaxed"></h2>
                    <div id="optionsContainer" class="space-y-3">
                        <!-- Options will be inserted here -->
                    </div>
                </div>

                <div class="flex justify-between">
                    <button id="prevButton" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-medium py-2 px-6 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                        ‚Üê Sebelumnya
                    </button>
                    <button id="nextButton" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                        Selanjutnya ‚Üí
                    </button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="bg-white rounded-2xl shadow-2xl p-8 text-center hidden">
                <div class="mb-6">
                    <div id="resultIcon" class="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-4xl" id="resultEmoji">üéâ</span>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Kuis Selesai!</h2>
                    <p id="resultMessage" class="text-gray-600 mb-4"></p>
                </div>

                <div class="bg-gray-50 rounded-xl p-6 mb-6">
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div>
                            <div class="text-2xl font-bold text-green-600" id="correctAnswers">0</div>
                            <div class="text-sm text-gray-600">Benar</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-red-600" id="wrongAnswers">0</div>
                            <div class="text-sm text-gray-600">Salah</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-purple-600" id="finalScore">0%</div>
                            <div class="text-sm text-gray-600">Skor</div>
                        </div>
                    </div>
                </div>

                <div class="space-y-3">
                    <button id="restartQuiz" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300">
                        Ulangi Kuis
                    </button>
                    <button id="reviewAnswers" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-6 rounded-xl transition-colors duration-200">
                        Lihat Pembahasan
                    </button>
                </div>
            </div>

            <!-- Review Screen -->
            <div id="reviewScreen" class="bg-white rounded-2xl shadow-2xl p-8 hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Pembahasan Jawaban</h2>
                    <p class="text-gray-600">Lihat jawaban yang benar dan penjelasannya</p>
                </div>
                <div id="reviewContainer" class="space-y-6 mb-6">
                    <!-- Review items will be inserted here -->
                </div>
                <button id="backToResults" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-all duration-200">
                    ‚Üê Kembali ke Hasil
                </button>
            </div>

            <!-- Error Screen -->
            <div id="errorScreen" class="bg-white rounded-2xl shadow-2xl p-8 text-center hidden">
                <div class="mb-6">
                    <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-3xl">‚ùå</span>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Terjadi Kesalahan</h2>
                    <p class="text-gray-600 mb-4">Tidak dapat memuat data kuis dari Google Sheet</p>
                    <p class="text-sm text-gray-500 mb-4">Pastikan link Google Sheet dapat diakses publik</p>
                    
                    <!-- Troubleshooting tips -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-4 text-left text-sm">
                        <h4 class="font-semibold mb-2">üí° Tips Mengatasi Masalah:</h4>
                        <ul class="space-y-1 text-gray-600">
                            <li>‚Ä¢ Pastikan Google Sheet sudah dipublikasi (File ‚Üí Share ‚Üí Publish to web)</li>
                            <li>‚Ä¢ Pilih "Entire Document" dan format "CSV"</li>
                            <li>‚Ä¢ Periksa format kolom: Pertanyaan, A, B, C, D, Kunci, Penjelasan</li>
                            <li>‚Ä¢ Pastikan ada data di baris kedua dan seterusnya</li>
                        </ul>
                    </div>
                </div>
                <div class="space-y-3">
                    <button id="retryLoad" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300">
                        Coba Lagi
                    </button>
                    <button id="testConnection" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-6 rounded-xl transition-colors duration-200">
                        Test Koneksi Google Sheet
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class QuizApp {
            constructor() {
                this.questions = [];
                this.currentQuestionIndex = 0;
                this.userAnswers = [];
                this.score = 0;
                this.csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXp8px6BoP8tsTKMbk7hMvX96h9O5MPS52OLnDm3JQ-1WpXWIS7e94-K-eAxtVHvONK_DEmoR_yka0/pub?output=csv';
                this.isQuizActive = false;
                this.securityWarnings = 0;
                
                this.initializeSecurity();
                this.initializeEventListeners();
                this.loadQuizData();
            }

            initializeSecurity() {
                // Prevent right-click context menu
                document.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.showSecurityWarning('Klik kanan tidak diizinkan selama kuis!');
                });

                // Prevent common keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Prevent F12, Ctrl+Shift+I, Ctrl+U, Ctrl+S, Ctrl+Shift+C, Ctrl+Shift+J
                    if (e.key === 'F12' || 
                        (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'C' || e.key === 'J')) ||
                        (e.ctrlKey && (e.key === 'u' || e.key === 'U' || e.key === 's' || e.key === 'S')) ||
                        (e.key === 'PrintScreen')) {
                        e.preventDefault();
                        this.showSecurityWarning('Shortcut keyboard tidak diizinkan!');
                    }
                });

                // Detect when user switches tabs or apps (visibility change)
                document.addEventListener('visibilitychange', () => {
                    if (this.isQuizActive && document.hidden) {
                        this.handleTabSwitch();
                    }
                });

                // Detect when window loses focus
                window.addEventListener('blur', () => {
                    if (this.isQuizActive) {
                        this.handleTabSwitch();
                    }
                });

                // Prevent text selection
                document.addEventListener('selectstart', (e) => {
                    if (this.isQuizActive) {
                        e.preventDefault();
                    }
                });

                // Detect mobile screenshot attempts (Android)
                if ('ontouchstart' in window) {
                    let volumeDownPressed = false;
                    let powerButtonPressed = false;

                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'VolumeDown') volumeDownPressed = true;
                        if (e.key === 'Power') powerButtonPressed = true;
                        
                        if (volumeDownPressed && powerButtonPressed) {
                            this.showSecurityWarning('Screenshot tidak diizinkan!');
                        }
                    });

                    document.addEventListener('keyup', (e) => {
                        if (e.key === 'VolumeDown') volumeDownPressed = false;
                        if (e.key === 'Power') powerButtonPressed = false;
                    });
                }

                // Disable drag and drop
                document.addEventListener('dragstart', (e) => e.preventDefault());
                document.addEventListener('drop', (e) => e.preventDefault());

                // Clear console periodically
                setInterval(() => {
                    if (this.isQuizActive) {
                        console.clear();
                    }
                }, 1000);

                // Obfuscate data in memory
                this.obfuscateData = true;
            }

            handleTabSwitch() {
                this.securityWarnings++;
                this.showSecurityWarning(`Peringatan ${this.securityWarnings}: Jangan berpindah aplikasi atau tab!`);
                
                if (this.securityWarnings >= 3) {
                    this.endQuizForViolation();
                }
            }

            showSecurityWarning(message) {
                // Remove existing warning
                const existingWarning = document.getElementById('securityWarning');
                if (existingWarning) {
                    existingWarning.remove();
                }

                // Create warning overlay
                const warning = document.createElement('div');
                warning.id = 'securityWarning';
                warning.className = 'fixed inset-0 bg-red-600 bg-opacity-95 flex items-center justify-center z-50';
                warning.innerHTML = `
                    <div class="bg-white rounded-xl p-8 text-center max-w-md mx-4 shadow-2xl">
                        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                        <h3 class="text-xl font-bold text-red-600 mb-2">Peringatan Keamanan!</h3>
                        <p class="text-gray-700 mb-4">${message}</p>
                        <p class="text-sm text-gray-500 mb-4">Peringatan: ${this.securityWarnings}/3</p>
                        <button onclick="this.parentElement.parentElement.remove()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg">
                            Mengerti
                        </button>
                    </div>
                `;
                
                document.body.appendChild(warning);
                
                // Auto remove after 3 seconds
                setTimeout(() => {
                    if (warning.parentElement) {
                        warning.remove();
                    }
                }, 3000);
            }

            endQuizForViolation() {
                this.isQuizActive = false;
                
                // Show violation screen
                const violationScreen = document.createElement('div');
                violationScreen.className = 'fixed inset-0 bg-red-600 flex items-center justify-center z-50';
                violationScreen.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 text-center max-w-md mx-4 shadow-2xl">
                        <div class="text-6xl mb-4">üö´</div>
                        <h2 class="text-2xl font-bold text-red-600 mb-4">Kuis Dihentikan</h2>
                        <p class="text-gray-700 mb-4">Anda telah melanggar aturan keamanan kuis sebanyak 3 kali.</p>
                        <p class="text-sm text-gray-500 mb-6">Silakan muat ulang halaman untuk memulai kembali.</p>
                        <button onclick="location.reload()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-xl">
                            Muat Ulang
                        </button>
                    </div>
                `;
                
                document.body.appendChild(violationScreen);
            }

            initializeEventListeners() {
                document.getElementById('startQuiz').addEventListener('click', () => this.startQuiz());
                document.getElementById('nextButton').addEventListener('click', () => this.nextQuestion());
                document.getElementById('prevButton').addEventListener('click', () => this.prevQuestion());
                document.getElementById('restartQuiz').addEventListener('click', () => this.restartQuiz());
                document.getElementById('reviewAnswers').addEventListener('click', () => this.showReview());
                document.getElementById('backToResults').addEventListener('click', () => this.showResults());
                document.getElementById('retryLoad').addEventListener('click', () => this.loadQuizData());
                document.getElementById('testConnection').addEventListener('click', () => this.testConnection());
            }

            async loadQuizData() {
                this.showScreen('loadingScreen');
                
                try {
                    // Add timeout and better error handling
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                    
                    const response = await fetch(this.csvUrl, {
                        method: 'GET',
                        headers: {
                            'Accept': 'text/csv,text/plain,*/*',
                            'Cache-Control': 'no-cache'
                        },
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const csvText = await response.text();
                    
                    if (!csvText || csvText.trim().length === 0) {
                        throw new Error('Empty response from Google Sheet');
                    }
                    
                    // Obfuscate the raw data immediately
                    this.parseCSV(csvText);
                    
                    if (this.questions.length === 0) {
                        throw new Error('No valid questions found in the sheet');
                    }
                    
                    // Encrypt questions data
                    this.encryptQuestions();
                    
                    this.showWelcomeScreen();
                } catch (error) {
                    console.error('Error loading quiz data:', error);
                    
                    // Show more specific error message
                    const errorElement = document.querySelector('#errorScreen p');
                    if (error.name === 'AbortError') {
                        errorElement.textContent = 'Koneksi timeout. Periksa koneksi internet Anda.';
                    } else if (error.message.includes('HTTP')) {
                        errorElement.textContent = 'Google Sheet tidak dapat diakses. Pastikan sheet dipublikasi dengan benar.';
                    } else if (error.message.includes('Empty response')) {
                        errorElement.textContent = 'Google Sheet kosong atau tidak berisi data.';
                    } else if (error.message.includes('No valid questions')) {
                        errorElement.textContent = 'Format data di Google Sheet tidak sesuai. Periksa kolom pertanyaan dan jawaban.';
                    } else {
                        errorElement.textContent = 'Tidak dapat memuat data kuis. Periksa koneksi internet dan format Google Sheet.';
                    }
                    
                    this.showScreen('errorScreen');
                }
            }

            encryptQuestions() {
                // Simple obfuscation to prevent easy inspection
                this.questions = this.questions.map(q => ({
                    ...q,
                    question: this.obfuscateText(q.question),
                    optionA: this.obfuscateText(q.optionA),
                    optionB: this.obfuscateText(q.optionB),
                    optionC: this.obfuscateText(q.optionC),
                    optionD: this.obfuscateText(q.optionD),
                    correctAnswer: this.obfuscateText(q.correctAnswer),
                    explanation: this.obfuscateText(q.explanation)
                }));
            }

            obfuscateText(text) {
                if (!text) return '';
                return btoa(encodeURIComponent(text));
            }

            deobfuscateText(text) {
                if (!text) return '';
                try {
                    return decodeURIComponent(atob(text));
                } catch {
                    return text;
                }
            }

            parseCSV(csvText) {
                const lines = csvText.trim().split(/\r?\n/);
                
                if (lines.length < 2) {
                    throw new Error('CSV must have at least header and one data row');
                }
                
                const headers = this.parseCSVLine(lines[0]).map(h => h.trim().toLowerCase());
                
                // Find column indices with more flexible matching
                const questionIndex = headers.findIndex(h => 
                    h.includes('pertanyaan') || h.includes('soal') || h.includes('question') || h.includes('quest')
                );
                const optionAIndex = headers.findIndex(h => 
                    (h.includes('a') || h.includes('option a') || h.includes('pilihan a')) && 
                    (h.includes('pilihan') || h.includes('option') || h === 'a')
                );
                const optionBIndex = headers.findIndex(h => 
                    (h.includes('b') || h.includes('option b') || h.includes('pilihan b')) && 
                    (h.includes('pilihan') || h.includes('option') || h === 'b')
                );
                const optionCIndex = headers.findIndex(h => 
                    (h.includes('c') || h.includes('option c') || h.includes('pilihan c')) && 
                    (h.includes('pilihan') || h.includes('option') || h === 'c')
                );
                const optionDIndex = headers.findIndex(h => 
                    (h.includes('d') || h.includes('option d') || h.includes('pilihan d')) && 
                    (h.includes('pilihan') || h.includes('option') || h === 'd')
                );
                const keyIndex = headers.findIndex(h => 
                    h.includes('kunci') || h.includes('jawaban') || h.includes('key') || h.includes('answer') || h.includes('correct')
                );
                const explanationIndex = headers.findIndex(h => 
                    h.includes('penjelasan') || h.includes('pembahasan') || h.includes('explanation') || h.includes('explain')
                );
                
                // Fallback to column positions if headers not found
                const questionCol = questionIndex >= 0 ? questionIndex : 0;
                const optionACol = optionAIndex >= 0 ? optionAIndex : 1;
                const optionBCol = optionBIndex >= 0 ? optionBIndex : 2;
                const optionCCol = optionCIndex >= 0 ? optionCIndex : 3;
                const optionDCol = optionDIndex >= 0 ? optionDIndex : 4;
                const keyCol = keyIndex >= 0 ? keyIndex : 5;
                const explanationCol = explanationIndex >= 0 ? explanationIndex : 6;
                
                this.questions = [];
                
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') continue; // Skip empty lines
                    
                    const values = this.parseCSVLine(lines[i]);
                    
                    // Ensure we have enough columns
                    const minRequiredCols = Math.max(questionCol, optionACol, optionBCol, optionCCol, optionDCol, keyCol) + 1;
                    
                    if (values.length >= minRequiredCols) {
                        const question = {
                            question: (values[questionCol] || '').trim(),
                            optionA: (values[optionACol] || '').trim(),
                            optionB: (values[optionBCol] || '').trim(),
                            optionC: (values[optionCCol] || '').trim(),
                            optionD: (values[optionDCol] || '').trim(),
                            correctAnswer: (values[keyCol] || '').toUpperCase().trim(),
                            explanation: (values[explanationCol] || 'Tidak ada penjelasan tersedia.').trim()
                        };
                        
                        // Validate question has required fields
                        if (question.question && 
                            question.correctAnswer && 
                            ['A', 'B', 'C', 'D'].includes(question.correctAnswer) &&
                            (question.optionA || question.optionB || question.optionC || question.optionD)) {
                            this.questions.push(question);
                        }
                    }
                }
                
                console.log(`Parsed ${this.questions.length} questions from CSV`);
            }

            async testConnection() {
                const testButton = document.getElementById('testConnection');
                const originalText = testButton.textContent;
                testButton.textContent = 'Testing...';
                testButton.disabled = true;
                
                try {
                    const response = await fetch(this.csvUrl, {
                        method: 'HEAD', // Just check if accessible
                        headers: {
                            'Accept': 'text/csv,text/plain,*/*'
                        }
                    });
                    
                    if (response.ok) {
                        // Try to get actual data
                        const dataResponse = await fetch(this.csvUrl);
                        const csvText = await dataResponse.text();
                        
                        const lines = csvText.trim().split(/\r?\n/);
                        
                        // Show connection test results
                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg text-left text-sm';
                        resultDiv.innerHTML = `
                            <h4 class="font-semibold text-blue-800 mb-2">üìä Hasil Test Koneksi:</h4>
                            <ul class="space-y-1 text-blue-700">
                                <li>‚úÖ Koneksi berhasil (Status: ${response.status})</li>
                                <li>üìÑ Total baris data: ${lines.length}</li>
                                <li>üìã Header: ${lines[0] ? lines[0].substring(0, 50) + '...' : 'Tidak ada'}</li>
                                <li>üìù Sample data: ${lines[1] ? lines[1].substring(0, 50) + '...' : 'Tidak ada'}</li>
                            </ul>
                            <p class="mt-2 text-xs text-blue-600">Jika masih error, periksa format kolom di Google Sheet</p>
                        `;
                        
                        // Remove existing result if any
                        const existingResult = document.querySelector('#errorScreen .mt-4.p-4.bg-blue-50');
                        if (existingResult) existingResult.remove();
                        
                        // Add result after the tips
                        const tipsDiv = document.querySelector('#errorScreen .bg-gray-50');
                        tipsDiv.parentNode.insertBefore(resultDiv, tipsDiv.nextSibling);
                        
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                } catch (error) {
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'mt-4 p-4 bg-red-50 border border-red-200 rounded-lg text-left text-sm';
                    resultDiv.innerHTML = `
                        <h4 class="font-semibold text-red-800 mb-2">‚ùå Test Koneksi Gagal:</h4>
                        <p class="text-red-700">${error.message}</p>
                        <p class="mt-2 text-xs text-red-600">Periksa kembali pengaturan publikasi Google Sheet</p>
                    `;
                    
                    // Remove existing result if any
                    const existingResult = document.querySelector('#errorScreen .mt-4.p-4');
                    if (existingResult) existingResult.remove();
                    
                    // Add result after the tips
                    const tipsDiv = document.querySelector('#errorScreen .bg-gray-50');
                    tipsDiv.parentNode.insertBefore(resultDiv, tipsDiv.nextSibling);
                }
                
                testButton.textContent = originalText;
                testButton.disabled = false;
            }

            parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current.trim());
                return result.map(item => item.replace(/^"|"$/g, ''));
            }

            showWelcomeScreen() {
                document.getElementById('totalQuestions').textContent = this.questions.length;
                this.showScreen('welcomeScreen');
            }

            startQuiz() {
                this.currentQuestionIndex = 0;
                this.userAnswers = new Array(this.questions.length).fill(null);
                this.score = 0;
                this.isQuizActive = true;
                this.securityWarnings = 0;
                
                // Show security notice
                this.showSecurityNotice();
                
                setTimeout(() => {
                    this.showQuestion();
                    this.showScreen('quizScreen');
                }, 3000);
            }

            showSecurityNotice() {
                const notice = document.createElement('div');
                notice.className = 'fixed inset-0 bg-blue-600 bg-opacity-95 flex items-center justify-center z-50';
                notice.innerHTML = `
                    <div class="bg-white rounded-xl p-8 text-center max-w-md mx-4 shadow-2xl">
                        <div class="text-6xl mb-4">üîí</div>
                        <h3 class="text-xl font-bold text-blue-600 mb-4">Mode Keamanan Aktif</h3>
                        <div class="text-left text-sm text-gray-700 mb-4">
                            <p class="mb-2">‚Ä¢ Screenshot dilarang</p>
                            <p class="mb-2">‚Ä¢ Klik kanan dinonaktifkan</p>
                            <p class="mb-2">‚Ä¢ Jangan berpindah tab/aplikasi</p>
                            <p class="mb-2">‚Ä¢ Maksimal 3 peringatan</p>
                        </div>
                        <div class="text-xs text-gray-500">Kuis akan dimulai dalam 3 detik...</div>
                    </div>
                `;
                
                document.body.appendChild(notice);
                
                setTimeout(() => {
                    notice.remove();
                }, 3000);
            }

            showQuestion() {
                const question = this.questions[this.currentQuestionIndex];
                
                // Remove any existing feedback
                const existingFeedback = document.getElementById('answerFeedback');
                if (existingFeedback) {
                    existingFeedback.remove();
                }
                
                document.getElementById('currentQuestion').textContent = this.currentQuestionIndex + 1;
                document.getElementById('totalQuestionsQuiz').textContent = this.questions.length;
                document.getElementById('currentScore').textContent = this.score;
                document.getElementById('questionText').textContent = this.deobfuscateText(question.question);
                
                const progress = ((this.currentQuestionIndex + 1) / this.questions.length) * 100;
                document.getElementById('progressBar').style.width = progress + '%';
                
                this.renderOptions();
                this.updateNavigationButtons();
            }

            renderOptions() {
                const question = this.questions[this.currentQuestionIndex];
                const container = document.getElementById('optionsContainer');
                const options = ['A', 'B', 'C', 'D'];
                const optionTexts = [
                    this.deobfuscateText(question.optionA), 
                    this.deobfuscateText(question.optionB), 
                    this.deobfuscateText(question.optionC), 
                    this.deobfuscateText(question.optionD)
                ];
                
                container.innerHTML = '';
                
                options.forEach((option, index) => {
                    if (optionTexts[index]) {
                        const button = document.createElement('button');
                        button.className = 'w-full text-left p-4 rounded-lg border-2 border-gray-200 hover:border-purple-300 hover:bg-purple-50 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500';
                        button.innerHTML = `
                            <span class="font-medium text-purple-600 mr-3">${option}.</span>
                            <span class="text-gray-800">${optionTexts[index]}</span>
                        `;
                        
                        // Check if this question was already answered
                        const wasAnswered = this.userAnswers[this.currentQuestionIndex] !== null;
                        const correctAnswer = this.deobfuscateText(question.correctAnswer);
                        
                        if (wasAnswered) {
                            // Disable button and show result styling
                            button.disabled = true;
                            button.classList.remove('hover:border-purple-300', 'hover:bg-purple-50');
                            
                            if (option === correctAnswer) {
                                button.classList.add('border-green-500', 'bg-green-100');
                            } else if (option === this.userAnswers[this.currentQuestionIndex]) {
                                button.classList.add('border-red-500', 'bg-red-100');
                            } else {
                                button.classList.add('border-gray-300', 'bg-gray-50');
                            }
                        } else {
                            // Enable interaction for unanswered questions
                            button.addEventListener('click', () => this.selectAnswer(option, button));
                        }
                        
                        container.appendChild(button);
                    }
                });
                
                // Show feedback if question was already answered
                if (this.userAnswers[this.currentQuestionIndex] !== null) {
                    const correctAnswer = this.deobfuscateText(question.correctAnswer);
                    const isCorrect = this.userAnswers[this.currentQuestionIndex] === correctAnswer;
                    this.showAnswerFeedback(isCorrect, question);
                }
            }

            selectAnswer(selectedOption, buttonElement) {
                const question = this.questions[this.currentQuestionIndex];
                const correctAnswer = this.deobfuscateText(question.correctAnswer);
                const isCorrect = selectedOption === correctAnswer;
                
                // Disable all buttons to prevent multiple selections
                const allButtons = document.querySelectorAll('#optionsContainer button');
                allButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.classList.remove('border-purple-500', 'bg-purple-100', 'hover:border-purple-300', 'hover:bg-purple-50');
                });
                
                // Show correct answer styling
                allButtons.forEach(btn => {
                    const buttonText = btn.textContent.trim();
                    const buttonOption = buttonText.charAt(0); // Get A, B, C, or D
                    
                    if (buttonOption === correctAnswer) {
                        // Correct answer - green
                        btn.classList.add('border-green-500', 'bg-green-100');
                        btn.classList.add('pulse-correct');
                    } else if (buttonOption === selectedOption && !isCorrect) {
                        // Wrong selected answer - red
                        btn.classList.add('border-red-500', 'bg-red-100');
                        btn.classList.add('shake-wrong');
                    } else {
                        // Other options - gray
                        btn.classList.add('border-gray-300', 'bg-gray-50');
                    }
                });
                
                // Store the answer
                this.userAnswers[this.currentQuestionIndex] = selectedOption;
                
                // Show feedback message
                this.showAnswerFeedback(isCorrect, question);
                
                // Enable next button after a short delay
                setTimeout(() => {
                    document.getElementById('nextButton').disabled = false;
                }, 1000);
            }

            showAnswerFeedback(isCorrect, question) {
                // Remove existing feedback
                const existingFeedback = document.getElementById('answerFeedback');
                if (existingFeedback) {
                    existingFeedback.remove();
                }
                
                // Create feedback element
                const feedback = document.createElement('div');
                feedback.id = 'answerFeedback';
                feedback.className = `mt-4 p-4 rounded-lg border-l-4 fade-in ${
                    isCorrect 
                        ? 'bg-green-50 border-green-400 text-green-800' 
                        : 'bg-red-50 border-red-400 text-red-800'
                }`;
                
                const correctAnswer = this.deobfuscateText(question.correctAnswer);
                const correctOptionText = this.getOptionText(question, correctAnswer);
                
                feedback.innerHTML = `
                    <div class="flex items-start">
                        <span class="text-2xl mr-3">${isCorrect ? '‚úÖ' : '‚ùå'}</span>
                        <div>
                            <p class="font-semibold mb-1">
                                ${isCorrect ? 'Benar!' : 'Salah!'}
                            </p>
                            ${!isCorrect ? `<p class="mb-2">Jawaban yang benar adalah <strong>${correctAnswer}. ${correctOptionText}</strong></p>` : ''}
                            <p class="text-sm opacity-90">${this.deobfuscateText(question.explanation)}</p>
                        </div>
                    </div>
                `;
                
                // Insert feedback after options
                const optionsContainer = document.getElementById('optionsContainer');
                optionsContainer.parentNode.insertBefore(feedback, optionsContainer.nextSibling);
            }

            getOptionText(question, option) {
                switch(option) {
                    case 'A': return this.deobfuscateText(question.optionA);
                    case 'B': return this.deobfuscateText(question.optionB);
                    case 'C': return this.deobfuscateText(question.optionC);
                    case 'D': return this.deobfuscateText(question.optionD);
                    default: return '';
                }
            }

            nextQuestion() {
                if (this.currentQuestionIndex < this.questions.length - 1) {
                    this.currentQuestionIndex++;
                    this.showQuestion();
                } else {
                    this.finishQuiz();
                }
            }

            prevQuestion() {
                if (this.currentQuestionIndex > 0) {
                    this.currentQuestionIndex--;
                    this.showQuestion();
                }
            }

            updateNavigationButtons() {
                const prevButton = document.getElementById('prevButton');
                const nextButton = document.getElementById('nextButton');
                
                prevButton.disabled = this.currentQuestionIndex === 0;
                
                const hasAnswer = this.userAnswers[this.currentQuestionIndex] !== null;
                nextButton.disabled = !hasAnswer;
                
                if (this.currentQuestionIndex === this.questions.length - 1) {
                    nextButton.textContent = 'Selesai';
                } else {
                    nextButton.textContent = 'Selanjutnya ‚Üí';
                }
            }

            finishQuiz() {
                this.calculateScore();
                this.showResults();
            }

            calculateScore() {
                this.score = 0;
                for (let i = 0; i < this.questions.length; i++) {
                    const correctAnswer = this.deobfuscateText(this.questions[i].correctAnswer);
                    if (this.userAnswers[i] === correctAnswer) {
                        this.score++;
                    }
                }
            }

            showResults() {
                const percentage = Math.round((this.score / this.questions.length) * 100);
                const correctCount = this.score;
                const wrongCount = this.questions.length - this.score;
                
                document.getElementById('correctAnswers').textContent = correctCount;
                document.getElementById('wrongAnswers').textContent = wrongCount;
                document.getElementById('finalScore').textContent = percentage + '%';
                
                // Set result message and icon based on score
                const resultIcon = document.getElementById('resultIcon');
                const resultEmoji = document.getElementById('resultEmoji');
                const resultMessage = document.getElementById('resultMessage');
                
                if (percentage >= 80) {
                    resultIcon.className = 'w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4';
                    resultEmoji.textContent = 'üéâ';
                    resultMessage.textContent = 'Luar biasa! Anda menguasai materi dengan sangat baik!';
                } else if (percentage >= 60) {
                    resultIcon.className = 'w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4';
                    resultEmoji.textContent = 'üëç';
                    resultMessage.textContent = 'Bagus! Masih ada ruang untuk perbaikan.';
                } else {
                    resultIcon.className = 'w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4';
                    resultEmoji.textContent = 'üí™';
                    resultMessage.textContent = 'Jangan menyerah! Coba lagi untuk hasil yang lebih baik.';
                }
                
                this.showScreen('resultsScreen');
            }

            showReview() {
                const container = document.getElementById('reviewContainer');
                container.innerHTML = '';
                
                this.questions.forEach((question, index) => {
                    const userAnswer = this.userAnswers[index];
                    const correctAnswer = this.deobfuscateText(question.correctAnswer);
                    const isCorrect = userAnswer === correctAnswer;
                    
                    const reviewItem = document.createElement('div');
                    reviewItem.className = 'border rounded-lg p-4 ' + (isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50');
                    
                    const options = ['A', 'B', 'C', 'D'];
                    const optionTexts = [
                        this.deobfuscateText(question.optionA), 
                        this.deobfuscateText(question.optionB), 
                        this.deobfuscateText(question.optionC), 
                        this.deobfuscateText(question.optionD)
                    ];
                    
                    reviewItem.innerHTML = `
                        <div class="mb-3">
                            <h3 class="font-semibold text-gray-800 mb-2">Pertanyaan ${index + 1}</h3>
                            <p class="text-gray-700 mb-3">${this.deobfuscateText(question.question)}</p>
                        </div>
                        <div class="grid grid-cols-1 gap-2 mb-3">
                            ${options.map((opt, i) => {
                                if (!optionTexts[i]) return '';
                                let className = 'p-2 rounded text-sm ';
                                if (opt === correctAnswer) {
                                    className += 'bg-green-100 text-green-800 font-medium';
                                } else if (opt === userAnswer && opt !== correctAnswer) {
                                    className += 'bg-red-100 text-red-800';
                                } else {
                                    className += 'bg-gray-100 text-gray-700';
                                }
                                return `<div class="${className}">${opt}. ${optionTexts[i]}</div>`;
                            }).join('')}
                        </div>
                        <div class="text-sm">
                            <p class="mb-1">
                                <span class="font-medium">Jawaban Anda:</span> 
                                <span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer || 'Tidak dijawab'}</span>
                            </p>
                            <p class="mb-2">
                                <span class="font-medium">Jawaban Benar:</span> 
                                <span class="text-green-600">${correctAnswer}</span>
                            </p>
                            <p class="text-gray-600">
                                <span class="font-medium">Penjelasan:</span> ${this.deobfuscateText(question.explanation)}
                            </p>
                        </div>
                    `;
                    
                    container.appendChild(reviewItem);
                });
                
                this.showScreen('reviewScreen');
            }

            restartQuiz() {
                this.isQuizActive = false;
                this.securityWarnings = 0;
                this.startQuiz();
            }

            showScreen(screenId) {
                const screens = ['loadingScreen', 'welcomeScreen', 'quizScreen', 'resultsScreen', 'reviewScreen', 'errorScreen'];
                screens.forEach(id => {
                    const element = document.getElementById(id);
                    if (id === screenId) {
                        element.classList.remove('hidden');
                        element.classList.add('fade-in');
                    } else {
                        element.classList.add('hidden');
                        element.classList.remove('fade-in');
                    }
                });
            }
        }

        // Initialize the quiz app when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new QuizApp();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98ffecfe82f881a4',t:'MTc2MDcwNTQ2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .correct-answer {
            animation: correctPulse 0.6s ease-in-out;
        }
        
        .wrong-answer {
            animation: wrongShake 0.6s ease-in-out;
        }
        
        .progress-fill {
            transition: width 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); background-color: #10b981; }
            100% { transform: scale(1); }
        }
        
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .navigation-toggle {
            transition: transform 0.3s ease;
        }
        
        .navigation-panel {
            transition: transform 0.3s ease;
        }
        
        .warning-modal {
            animation: warningPulse 0.5s ease-in-out;
        }
        
        @keyframes warningPulse {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .timer-warning {
            animation: timerBlink 1s infinite;
        }
        
        @keyframes timerBlink {
            0%, 50% { background-color: #ef4444; }
            51%, 100% { background-color: #dc2626; }
        }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 font-sans overflow-hidden">
    <!-- Login Screen -->
    <div id="loginScreen" class="h-full flex items-center justify-center fade-in">
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 w-96 shadow-2xl border border-white/20">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">🎯 Kuis Interaktif</h1>
                <p class="text-blue-200">Masuk untuk memulai kuis</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-white mb-2">Username</label>
                    <input type="text" id="username" required 
                           class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                </div>
                
                <div>
                    <label for="password" class="block text-sm font-medium text-white mb-2">Password</label>
                    <input type="password" id="password" required 
                           class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                </div>
                
                <button type="submit" 
                        class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                    Masuk
                </button>
            </form>
            
            <div id="loginError" class="mt-4 text-red-300 text-sm text-center hidden"></div>
        </div>
    </div>

    <!-- Profile Screen -->
    <div id="profileScreen" class="h-full flex items-center justify-center hidden">
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 w-96 shadow-2xl border border-white/20 slide-in">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center text-2xl">
                    👤
                </div>
                <h2 class="text-2xl font-bold text-white mb-2">Profil Peserta</h2>
            </div>
            
            <div class="space-y-4 mb-8">
                <div class="bg-white/10 rounded-lg p-4">
                    <label class="block text-sm text-blue-200 mb-1">No. Absen</label>
                    <div id="profileAbsen" class="text-white font-semibold"></div>
                </div>
                
                <div class="bg-white/10 rounded-lg p-4">
                    <label class="block text-sm text-blue-200 mb-1">Nama Lengkap</label>
                    <div id="profileNama" class="text-white font-semibold"></div>
                </div>
                
                <div class="bg-white/10 rounded-lg p-4">
                    <label class="block text-sm text-blue-200 mb-1">Kelas</label>
                    <div id="profileKelas" class="text-white font-semibold"></div>
                </div>
            </div>
            
            <button id="startQuizBtn" 
                    class="w-full bg-gradient-to-r from-green-500 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                🚀 Mulai Kuis
            </button>
        </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quizScreen" class="h-full hidden">
        <!-- Header -->
        <header class="bg-white/10 backdrop-blur-lg border-b border-white/20 p-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <button id="navToggle" class="text-white hover:text-blue-300 transition-colors navigation-toggle">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold text-white">Kuis Interaktif</h1>
                </div>
                
                <div class="flex items-center space-x-6">
                    <div class="text-white">
                        <span class="text-sm">Soal </span>
                        <span id="currentQuestion" class="font-bold">1</span>
                        <span class="text-sm"> dari </span>
                        <span id="totalQuestions" class="font-bold">0</span>
                    </div>
                    
                    <div id="timer" class="bg-red-500 text-white px-4 py-2 rounded-lg font-bold">
                        50:00
                    </div>
                    
                    <div class="text-white">
                        <span class="text-sm">Skor: </span>
                        <span id="score" class="font-bold">0</span>
                    </div>
                </div>
            </div>
            
            <!-- Progress Bar -->
            <div class="mt-4 bg-white/20 rounded-full h-2">
                <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full progress-fill" style="width: 0%"></div>
            </div>
        </header>

        <!-- Navigation Panel -->
        <div id="navigationPanel" class="fixed left-0 top-0 h-full w-80 bg-white/10 backdrop-blur-lg border-r border-white/20 transform -translate-x-full navigation-panel z-40">
            <div class="p-4">
                <h3 class="text-white font-bold mb-4">Navigasi Soal</h3>
                <div id="questionNav" class="grid grid-cols-5 gap-2"></div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="flex-1 p-6 overflow-y-auto" style="height: calc(100% - 120px);">
            <div class="max-w-4xl mx-auto">
                <div id="questionContainer" class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl border border-white/20">
                    <!-- Question will be loaded here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Result Screen -->
    <div id="resultScreen" class="h-full flex items-center justify-center hidden">
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 w-96 shadow-2xl border border-white/20 slide-in text-center">
            <div id="resultIcon" class="text-6xl mb-4">🎉</div>
            <h2 class="text-3xl font-bold text-white mb-4">Kuis Selesai!</h2>
            
            <div class="bg-white/10 rounded-lg p-6 mb-6">
                <div class="text-4xl font-bold text-white mb-2" id="finalScore">0</div>
                <div class="text-blue-200">Skor Akhir</div>
                <div id="scoreMessage" class="text-white mt-2 font-semibold"></div>
            </div>
            
            <div class="text-blue-200 mb-4">
                Kembali ke login dalam <span id="countdown" class="font-bold text-white">2</span> detik
            </div>
        </div>
    </div>

    <!-- Warning Modal -->
    <div id="warningModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="bg-red-500 text-white p-6 rounded-2xl shadow-2xl warning-modal max-w-md">
            <div class="text-center">
                <div class="text-4xl mb-4">⚠️</div>
                <h3 class="text-xl font-bold mb-2">Peringatan!</h3>
                <p id="warningMessage" class="mb-4"></p>
                <p class="text-sm">Peringatan: <span id="warningCount">1</span>/3</p>
                <button id="warningOk" class="mt-4 bg-white text-red-500 px-6 py-2 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                    Mengerti
                </button>
            </div>
        </div>
    </div>

    <script>
        class QuizApp {
            constructor() {
                this.currentUser = null;
                this.questions = [];
                this.currentQuestionIndex = 0;
                this.score = 0;
                this.answers = [];
                this.timeLeft = 50 * 60; // 50 minutes in seconds
                this.timer = null;
                this.warningCount = 0;
                this.quizCompleted = false;
                this.navigationVisible = false;
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.setupSecurityFeatures();
                this.loadUserData();
            }
            
            setupEventListeners() {
                document.getElementById('loginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });
                
                document.getElementById('startQuizBtn').addEventListener('click', () => {
                    this.startQuiz();
                });
                
                document.getElementById('navToggle').addEventListener('click', () => {
                    this.toggleNavigation();
                });
                
                document.getElementById('warningOk').addEventListener('click', () => {
                    this.hideWarning();
                });
                
                // Prevent context menu
                document.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.showWarning('Klik kanan tidak diizinkan!');
                });
                
                // Prevent keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.altKey || e.metaKey || e.key === 'F12' || e.key === 'PrintScreen') {
                        e.preventDefault();
                        this.showWarning('Shortcut keyboard tidak diizinkan!');
                    }
                });
                
                // Detect tab switching
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && !this.quizCompleted && this.currentUser) {
                        this.showWarning('Jangan beralih tab selama kuis!');
                    }
                });
            }
            
            setupSecurityFeatures() {
                // Disable screenshot (limited effectiveness)
                document.addEventListener('keyup', (e) => {
                    if (e.key === 'PrintScreen') {
                        this.showWarning('Screenshot tidak diizinkan!');
                    }
                });
                
                // Disable developer tools detection
                setInterval(() => {
                    if (window.outerHeight - window.innerHeight > 200 || window.outerWidth - window.innerWidth > 200) {
                        this.showWarning('Developer tools terdeteksi!');
                    }
                }, 1000);
            }
            
            async loadUserData() {
                try {
                    const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vSXp8px6BoP8tsTKMbk7hMvX96h9O5MPS52OLnDm3JQ-1WpXWIS7e94-K-eAxtVHvONK_DEmoR_yka0/pub?gid=1934144092&single=true&output=csv');
                    const csvText = await response.text();
                    this.userData = this.parseCSV(csvText);
                } catch (error) {
                    console.error('Error loading user data:', error);
                    this.userData = [];
                }
            }
            
            async loadQuestions() {
                try {
                    const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vS6MUHUUMK-sG6H063aooPSe7p1hol73KsFMfBBmzTLHFGs33oiuoGpMZd66lRQNvNcVSx1l9P8KgIe/pub?gid=0&single=true&output=csv');
                    const csvText = await response.text();
                    const rawData = this.parseCSV(csvText);
                    
                    this.questions = rawData.map((row, index) => ({
                        id: index + 1,
                        question: row[0] || '',
                        options: [row[1] || '', row[2] || '', row[3] || '', row[4] || ''].filter(opt => opt.trim()),
                        correctAnswer: row[5] || 'A',
                        explanation: row[6] || '',
                        image: row[7] || ''
                    })).filter(q => q.question.trim());
                    
                    document.getElementById('totalQuestions').textContent = this.questions.length;
                    this.createQuestionNavigation();
                } catch (error) {
                    console.error('Error loading questions:', error);
                    this.questions = [];
                }
            }
            
            parseCSV(csvText) {
                const lines = csvText.split('\n');
                return lines.slice(1).map(line => {
                    const result = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            result.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    result.push(current.trim());
                    return result;
                });
            }
            
            handleLogin() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                const user = this.userData.find(row => 
                    row[0] === username && row[1] === password
                );
                
                if (user) {
                    this.currentUser = {
                        username: user[0],
                        password: user[1],
                        absen: user[2] || '',
                        nama: user[3] || '',
                        kelas: user[4] || ''
                    };
                    
                    this.showProfile();
                } else {
                    this.showLoginError('Username atau password salah!');
                }
            }
            
            showLoginError(message) {
                const errorDiv = document.getElementById('loginError');
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
                setTimeout(() => errorDiv.classList.add('hidden'), 3000);
            }
            
            showProfile() {
                document.getElementById('profileAbsen').textContent = this.currentUser.absen;
                document.getElementById('profileNama').textContent = this.currentUser.nama;
                document.getElementById('profileKelas').textContent = this.currentUser.kelas;
                
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('profileScreen').classList.remove('hidden');
            }
            
            async startQuiz() {
                await this.loadQuestions();
                
                if (this.questions.length === 0) {
                    alert('Tidak ada soal yang tersedia!');
                    return;
                }
                
                document.getElementById('profileScreen').classList.add('hidden');
                document.getElementById('quizScreen').classList.remove('hidden');
                
                this.startTimer();
                this.displayQuestion();
            }
            
            startTimer() {
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    
                    const minutes = Math.floor(this.timeLeft / 60);
                    const seconds = this.timeLeft % 60;
                    const timerElement = document.getElementById('timer');
                    
                    timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (this.timeLeft <= 300) { // 5 minutes warning
                        timerElement.classList.add('timer-warning');
                    }
                    
                    if (this.timeLeft <= 0) {
                        this.endQuiz();
                    }
                }, 1000);
            }
            
            createQuestionNavigation() {
                const navContainer = document.getElementById('questionNav');
                navContainer.innerHTML = '';
                
                this.questions.forEach((_, index) => {
                    const button = document.createElement('button');
                    button.textContent = index + 1;
                    button.className = 'w-10 h-10 rounded-lg bg-white/20 text-white hover:bg-white/30 transition-colors';
                    button.addEventListener('click', () => {
                        this.goToQuestion(index);
                        this.toggleNavigation();
                    });
                    navContainer.appendChild(button);
                });
            }
            
            toggleNavigation() {
                this.navigationVisible = !this.navigationVisible;
                const panel = document.getElementById('navigationPanel');
                
                if (this.navigationVisible) {
                    panel.style.transform = 'translateX(0)';
                } else {
                    panel.style.transform = 'translateX(-100%)';
                }
            }
            
            displayQuestion() {
                const question = this.questions[this.currentQuestionIndex];
                const container = document.getElementById('questionContainer');
                
                let imageHtml = '';
                if (question.image) {
                    imageHtml = `<img src="${question.image}" alt="Gambar soal" class="max-w-full h-auto rounded-lg mb-4" onerror="this.style.display='none';">`;
                }
                
                container.innerHTML = `
                    <div class="fade-in">
                        <h2 class="text-2xl font-bold text-white mb-6">
                            Soal ${this.currentQuestionIndex + 1}
                        </h2>
                        
                        ${imageHtml}
                        
                        <p class="text-lg text-white mb-8 leading-relaxed">
                            ${question.question}
                        </p>
                        
                        <div class="space-y-4" id="optionsContainer">
                            ${question.options.map((option, index) => `
                                <button class="option-btn w-full text-left p-4 bg-white/10 hover:bg-white/20 rounded-lg text-white transition-all duration-200 border border-white/20 hover:border-white/40"
                                        data-option="${String.fromCharCode(65 + index)}"
                                        ${this.answers[this.currentQuestionIndex] ? 'disabled' : ''}>
                                    <span class="font-semibold mr-3">${String.fromCharCode(65 + index)}.</span>
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                        
                        <div id="feedback" class="mt-6 hidden"></div>
                        
                        <div class="flex justify-between mt-8">
                            <button id="prevBtn" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors ${this.currentQuestionIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                                    ${this.currentQuestionIndex === 0 ? 'disabled' : ''}>
                                ← Sebelumnya
                            </button>
                            
                            <button id="nextBtn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors ${this.currentQuestionIndex === this.questions.length - 1 ? 'hidden' : ''}">
                                Selanjutnya →
                            </button>
                            
                            <button id="finishBtn" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors ${this.currentQuestionIndex === this.questions.length - 1 ? '' : 'hidden'}">
                                Selesai
                            </button>
                        </div>
                    </div>
                `;
                
                this.setupQuestionEventListeners();
                this.updateProgress();
                this.updateQuestionCounter();
                this.updateNavigationButtons();
            }
            
            setupQuestionEventListeners() {
                const optionButtons = document.querySelectorAll('.option-btn');
                optionButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (!this.answers[this.currentQuestionIndex]) {
                            this.selectAnswer(e.target.closest('.option-btn').dataset.option);
                        }
                    });
                });
                
                document.getElementById('prevBtn')?.addEventListener('click', () => {
                    if (this.currentQuestionIndex > 0) {
                        this.currentQuestionIndex--;
                        this.displayQuestion();
                    }
                });
                
                document.getElementById('nextBtn')?.addEventListener('click', () => {
                    if (this.currentQuestionIndex < this.questions.length - 1) {
                        this.currentQuestionIndex++;
                        this.displayQuestion();
                    }
                });
                
                document.getElementById('finishBtn')?.addEventListener('click', () => {
                    this.endQuiz();
                });
            }
            
            selectAnswer(selectedOption) {
                const question = this.questions[this.currentQuestionIndex];
                const isCorrect = selectedOption === question.correctAnswer;
                
                this.answers[this.currentQuestionIndex] = selectedOption;
                
                if (isCorrect) {
                    this.score += 10;
                }
                
                this.showFeedback(selectedOption, isCorrect);
                this.updateScore();
                this.updateNavigationButtons();
                
                // Disable all option buttons
                document.querySelectorAll('.option-btn').forEach(btn => {
                    btn.disabled = true;
                });
            }
            
            showFeedback(selectedOption, isCorrect) {
                const question = this.questions[this.currentQuestionIndex];
                const feedbackDiv = document.getElementById('feedback');
                const selectedBtn = document.querySelector(`[data-option="${selectedOption}"]`);
                const correctBtn = document.querySelector(`[data-option="${question.correctAnswer}"]`);
                
                if (isCorrect) {
                    selectedBtn.classList.add('correct-answer', 'bg-green-500');
                    feedbackDiv.innerHTML = `
                        <div class="bg-green-500/20 border border-green-500 rounded-lg p-4 slide-in">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">✅</span>
                                <span class="text-green-300 font-semibold">Jawaban Benar!</span>
                            </div>
                            ${question.explanation ? `<p class="text-white">${question.explanation}</p>` : ''}
                        </div>
                    `;
                } else {
                    selectedBtn.classList.add('wrong-answer', 'bg-red-500');
                    correctBtn.classList.add('bg-green-500');
                    feedbackDiv.innerHTML = `
                        <div class="bg-red-500/20 border border-red-500 rounded-lg p-4 slide-in">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">❌</span>
                                <span class="text-red-300 font-semibold">Jawaban Salah!</span>
                            </div>
                            <p class="text-white mb-2">Jawaban yang benar: <strong>${question.correctAnswer}</strong></p>
                            ${question.explanation ? `<p class="text-white">${question.explanation}</p>` : ''}
                        </div>
                    `;
                }
                
                feedbackDiv.classList.remove('hidden');
            }
            
            updateScore() {
                document.getElementById('score').textContent = this.score;
            }
            
            updateProgress() {
                const progress = ((this.currentQuestionIndex + 1) / this.questions.length) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
            }
            
            updateQuestionCounter() {
                document.getElementById('currentQuestion').textContent = this.currentQuestionIndex + 1;
            }
            
            updateNavigationButtons() {
                const navButtons = document.querySelectorAll('#questionNav button');
                navButtons.forEach((btn, index) => {
                    btn.classList.remove('bg-green-500', 'bg-blue-500');
                    if (this.answers[index]) {
                        btn.classList.add('bg-green-500');
                    } else if (index === this.currentQuestionIndex) {
                        btn.classList.add('bg-blue-500');
                    }
                });
            }
            
            goToQuestion(index) {
                this.currentQuestionIndex = index;
                this.displayQuestion();
            }
            
            async endQuiz() {
                this.quizCompleted = true;
                clearInterval(this.timer);
                
                const finalScore = Math.round((this.score / (this.questions.length * 10)) * 100);
                
                // Save result to Google Sheets
                await this.saveResult(finalScore);
                
                this.showResult(finalScore);
            }
            
            async saveResult(finalScore) {
                try {
                    const formData = new FormData();
                    formData.append('NIS', this.currentUser.username);
                    formData.append('Absen', this.currentUser.absen);
                    formData.append('NamaLengkap', this.currentUser.nama);
                    formData.append('Kelas', this.currentUser.kelas);
                    formData.append('HasilNilai', finalScore);
                    
                    await fetch('https://script.google.com/macros/s/AKfycbyy0FYm7Djd8RoyCjGKgXqCAJtO2qpmT4EI7CoiToseDfF-M45TlgG1yng7cJH-7G8pgw/exec', {
                        method: 'POST',
                        body: formData
                    });
                } catch (error) {
                    console.error('Error saving result:', error);
                }
            }
            
            showResult(finalScore) {
                document.getElementById('quizScreen').classList.add('hidden');
                document.getElementById('resultScreen').classList.remove('hidden');
                
                document.getElementById('finalScore').textContent = finalScore;
                
                let message = '';
                let icon = '';
                
                if (finalScore >= 90) {
                    message = 'Luar Biasa! 🌟';
                    icon = '🏆';
                    this.triggerConfetti();
                } else if (finalScore >= 80) {
                    message = 'Sangat Baik! 👏';
                    icon = '🎉';
                } else if (finalScore >= 70) {
                    message = 'Baik! 👍';
                    icon = '😊';
                } else if (finalScore >= 60) {
                    message = 'Cukup 📚';
                    icon = '😐';
                } else {
                    message = 'Perlu Belajar Lagi 💪';
                    icon = '😔';
                }
                
                document.getElementById('resultIcon').textContent = icon;
                document.getElementById('scoreMessage').textContent = message;
                
                // Countdown to login
                let countdown = 2;
                const countdownElement = document.getElementById('countdown');
                const countdownTimer = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(countdownTimer);
                        this.resetToLogin();
                    }
                }, 1000);
            }
            
            triggerConfetti() {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
                
                setTimeout(() => {
                    confetti({
                        particleCount: 50,
                        angle: 60,
                        spread: 55,
                        origin: { x: 0 }
                    });
                }, 250);
                
                setTimeout(() => {
                    confetti({
                        particleCount: 50,
                        angle: 120,
                        spread: 55,
                        origin: { x: 1 }
                    });
                }, 400);
            }
            
            resetToLogin() {
                // Reset all data
                this.currentUser = null;
                this.questions = [];
                this.currentQuestionIndex = 0;
                this.score = 0;
                this.answers = [];
                this.timeLeft = 50 * 60;
                this.warningCount = 0;
                this.quizCompleted = false;
                this.navigationVisible = false;
                
                // Clear forms
                document.getElementById('loginForm').reset();
                
                // Show login screen
                document.getElementById('resultScreen').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
            }
            
            showWarning(message) {
                this.warningCount++;
                
                if (this.warningCount >= 3) {
                    alert('Terlalu banyak pelanggaran! Kuis dihentikan.');
                    this.endQuiz();
                    return;
                }
                
                document.getElementById('warningMessage').textContent = message;
                document.getElementById('warningCount').textContent = this.warningCount;
                document.getElementById('warningModal').classList.remove('hidden');
            }
            
            hideWarning() {
                document.getElementById('warningModal').classList.add('hidden');
            }
        }
        
        // Initialize the quiz app
        const quizApp = new QuizApp();
        
        // Make fullscreen
        document.documentElement.requestFullscreen?.() || 
        document.documentElement.webkitRequestFullscreen?.() || 
        document.documentElement.msRequestFullscreen?.();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99015d39b3774e24',t:'MTc2MDcyMDU1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
            40%, 43% { transform: translateY(-30px); }
            70% { transform: translateY(-15px); }
            90% { transform: translateY(-4px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .animate-fadeIn { animation: fadeIn 0.6s ease-out; }
        .animate-slideIn { animation: slideIn 0.5s ease-out; }
        .animate-bounce-custom { animation: bounce 0.6s; }
        .animate-shake { animation: shake 0.5s; }
        .animate-pulse-custom { animation: pulse 2s infinite; }
        
        .correct-answer {
            background: linear-gradient(135deg, #10b981, #059669);
            animation: bounce 0.6s;
        }
        
        .wrong-answer {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            animation: shake 0.5s;
        }
        
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f39c12;
            animation: confetti-fall 3s linear infinite;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .security-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 font-sans">
    <!-- Security Overlay -->
    <div id="securityOverlay" class="security-overlay hidden">
        <div class="text-center">
            <div class="text-6xl mb-4">‚ö†Ô∏è</div>
            <div class="text-2xl mb-4">Peringatan Keamanan!</div>
            <div id="securityMessage" class="text-lg mb-4"></div>
            <div id="warningCount" class="text-xl font-bold text-red-400"></div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-full flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-fadeIn">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üìö</div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Kuis Interaktif</h1>
                <p class="text-gray-600">Masuk untuk memulai kuis</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <input type="text" id="username" name="username" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                </div>
                
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="password" name="password" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                </div>
                
                <button type="submit" id="loginBtn" 
                        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all transform hover:scale-105">
                    Masuk
                </button>
            </form>
            
            <div id="loginError" class="mt-4 text-red-600 text-center hidden"></div>
        </div>
    </div>

    <!-- Profile Screen -->
    <div id="profileScreen" class="min-h-full flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-fadeIn">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üë§</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Profil Peserta</h2>
                
                <div class="space-y-4 text-left">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-600">No. Absen</label>
                        <div id="profileAbsen" class="text-lg font-semibold text-gray-800"></div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-600">Nama Lengkap</label>
                        <div id="profileNama" class="text-lg font-semibold text-gray-800"></div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-600">Kelas</label>
                        <div id="profileKelas" class="text-lg font-semibold text-gray-800"></div>
                    </div>
                </div>
                
                <button id="startQuizBtn" 
                        class="w-full mt-6 bg-gradient-to-r from-green-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-green-700 hover:to-blue-700 transition-all transform hover:scale-105 animate-pulse-custom">
                    Mulai Kuis
                </button>
            </div>
        </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quizScreen" class="min-h-full p-4 hidden">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-6 animate-slideIn">
            <div class="flex justify-between items-center mb-4">
                <div class="text-lg font-semibold text-gray-800">
                    Soal <span id="currentQuestion">1</span> dari <span id="totalQuestions">0</span>
                </div>
                <div class="text-lg font-semibold text-blue-600">
                    Skor: <span id="currentScore">0</span>
                </div>
            </div>
            
            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div id="progressBar" class="progress-bar bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full" style="width: 0%"></div>
            </div>
        </div>

        <!-- Question Card -->
        <div id="questionCard" class="bg-white rounded-xl shadow-lg p-6 mb-6 animate-fadeIn">
            <div id="questionText" class="text-xl font-semibold text-gray-800 mb-6"></div>
            
            <div id="optionsContainer" class="space-y-3">
                <!-- Options will be inserted here -->
            </div>
        </div>

        <!-- Feedback Card -->
        <div id="feedbackCard" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
            <div id="feedbackContent"></div>
            <button id="nextBtn" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-all">
                Soal Berikutnya
            </button>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="resultsScreen" class="min-h-full flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-fadeIn text-center">
            <div id="resultIcon" class="text-8xl mb-4"></div>
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Kuis Selesai!</h2>
            
            <div class="space-y-4 mb-6">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600">Skor Akhir</div>
                    <div id="finalScore" class="text-3xl font-bold text-blue-600"></div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600">Jawaban Benar</div>
                    <div id="correctAnswers" class="text-xl font-semibold text-green-600"></div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600">Total Soal</div>
                    <div id="totalQuestionsResult" class="text-xl font-semibold text-gray-800"></div>
                </div>
            </div>
            
            <div id="appreciationMessage" class="text-lg font-semibold mb-4"></div>
            
            <button onclick="location.reload()" 
                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all">
                Selesai
            </button>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let correctAnswersCount = 0;
        let warningCount = 0;
        let quizStarted = false;
        let hasSubmittedResult = false;

        // Security features
        let isTabActive = true;
        let screenshotAttempts = 0;

        // Initialize security features
        function initSecurity() {
            // Disable right-click
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                showSecurityWarning('Klik kanan tidak diizinkan!');
            });

            // Disable common shortcuts
            document.addEventListener('keydown', function(e) {
                // F12, Ctrl+Shift+I, Ctrl+U, Ctrl+S, Ctrl+Shift+C, Ctrl+A, Ctrl+C, Ctrl+V
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'C')) ||
                    (e.ctrlKey && (e.key === 'u' || e.key === 's' || e.key === 'a' || e.key === 'c' || e.key === 'v'))) {
                    e.preventDefault();
                    showSecurityWarning('Shortcut keyboard tidak diizinkan!');
                }

                // Print Screen detection
                if (e.key === 'PrintScreen') {
                    e.preventDefault();
                    showSecurityWarning('Screenshot tidak diizinkan!');
                }
            });

            // Tab switching detection
            document.addEventListener('visibilitychange', function() {
                if (quizStarted && document.hidden) {
                    isTabActive = false;
                    showSecurityWarning('Perpindahan tab terdeteksi!');
                } else {
                    isTabActive = true;
                }
            });

            // Window focus detection
            window.addEventListener('blur', function() {
                if (quizStarted) {
                    showSecurityWarning('Jendela kehilangan fokus!');
                }
            });

            // Disable text selection
            document.addEventListener('selectstart', function(e) {
                if (quizStarted) {
                    e.preventDefault();
                }
            });
        }

        function showSecurityWarning(message) {
            if (!quizStarted) return;
            
            warningCount++;
            const overlay = document.getElementById('securityOverlay');
            const messageEl = document.getElementById('securityMessage');
            const warningCountEl = document.getElementById('warningCount');
            
            messageEl.textContent = message;
            warningCountEl.textContent = `Peringatan ${warningCount}/3`;
            
            overlay.classList.remove('hidden');
            
            if (warningCount >= 3) {
                setTimeout(() => {
                    alert('Kuis dihentikan karena terlalu banyak pelanggaran keamanan!');
                    location.reload();
                }, 2000);
            } else {
                setTimeout(() => {
                    overlay.classList.add('hidden');
                }, 3000);
            }
        }

        // Load user data from Google Sheets
        async function loadUserData() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vSXp8px6BoP8tsTKMbk7hMvX96h9O5MPS52OLnDm3JQ-1WpXWIS7e94-K-eAxtVHvONK_DEmoR_yka0/pub?gid=1934144092&single=true&output=csv');
                const csvText = await response.text();
                const lines = csvText.split('\n');
                const users = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const columns = lines[i].split(',');
                    if (columns.length >= 5) {
                        users.push({
                            username: columns[0]?.trim(),
                            password: columns[1]?.trim(),
                            absen: columns[2]?.trim(),
                            nama: columns[3]?.trim(),
                            kelas: columns[4]?.trim()
                        });
                    }
                }
                return users;
            } catch (error) {
                console.error('Error loading user data:', error);
                return [];
            }
        }

        // Load questions from Google Sheets
        async function loadQuestions() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vS6MUHUUMK-sG6H063aooPSe7p1hol73KsFMfBBmzTLHFGs33oiuoGpMZd66lRQNvNcVSx1l9P8KgIe/pub?gid=0&single=true&output=csv');
                const csvText = await response.text();
                const lines = csvText.split('\n');
                const questionsList = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const columns = lines[i].split(',');
                    if (columns.length >= 6) {
                        questionsList.push({
                            question: columns[0]?.trim(),
                            options: [
                                columns[1]?.trim(),
                                columns[2]?.trim(),
                                columns[3]?.trim(),
                                columns[4]?.trim()
                            ],
                            correctAnswer: columns[5]?.trim(),
                            explanation: columns[6]?.trim() || 'Tidak ada penjelasan tersedia.'
                        });
                    }
                }
                return questionsList;
            } catch (error) {
                console.error('Error loading questions:', error);
                return [];
            }
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            const loginError = document.getElementById('loginError');
            
            loginBtn.textContent = 'Memuat...';
            loginBtn.disabled = true;
            
            const users = await loadUserData();
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                showProfile();
                loginError.classList.add('hidden');
            } else {
                loginError.textContent = 'Username atau password salah!';
                loginError.classList.remove('hidden');
            }
            
            loginBtn.textContent = 'Masuk';
            loginBtn.disabled = false;
        });

        function showProfile() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('profileScreen').classList.remove('hidden');
            
            document.getElementById('profileAbsen').textContent = currentUser.absen;
            document.getElementById('profileNama').textContent = currentUser.nama;
            document.getElementById('profileKelas').textContent = currentUser.kelas;
        }

        // Start quiz
        document.getElementById('startQuizBtn').addEventListener('click', async function() {
            questions = await loadQuestions();
            if (questions.length === 0) {
                alert('Tidak dapat memuat soal. Silakan coba lagi.');
                return;
            }
            
            quizStarted = true;
            document.getElementById('profileScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            
            document.getElementById('totalQuestions').textContent = questions.length;
            showQuestion();
        });

        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const questionCard = document.getElementById('questionCard');
            
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionButton = document.createElement('button');
                optionButton.className = 'w-full p-4 text-left bg-gray-50 hover:bg-gray-100 rounded-lg border-2 border-transparent hover:border-blue-300 transition-all transform hover:scale-102';
                optionButton.textContent = `${String.fromCharCode(65 + index)}. ${option}`;
                optionButton.addEventListener('click', () => selectAnswer(option, optionButton));
                optionsContainer.appendChild(optionButton);
            });
            
            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            // Hide feedback card
            document.getElementById('feedbackCard').classList.add('hidden');
            questionCard.classList.remove('hidden');
        }

        function selectAnswer(selectedAnswer, buttonElement) {
            const question = questions[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correctAnswer;
            
            // Disable all option buttons
            const optionButtons = document.querySelectorAll('#optionsContainer button');
            optionButtons.forEach(btn => btn.disabled = true);
            
            if (isCorrect) {
                score += 10;
                correctAnswersCount++;
                buttonElement.className = 'w-full p-4 text-left text-white rounded-lg correct-answer';
                document.getElementById('currentScore').textContent = score;
            } else {
                buttonElement.className = 'w-full p-4 text-left text-white rounded-lg wrong-answer';
                
                // Highlight correct answer
                optionButtons.forEach(btn => {
                    if (btn.textContent.includes(question.correctAnswer)) {
                        btn.className = 'w-full p-4 text-left text-white rounded-lg correct-answer';
                    }
                });
            }
            
            // Show feedback
            setTimeout(() => {
                showFeedback(isCorrect, question);
            }, 1000);
        }

        function showFeedback(isCorrect, question) {
            const feedbackCard = document.getElementById('feedbackCard');
            const feedbackContent = document.getElementById('feedbackContent');
            
            if (isCorrect) {
                feedbackContent.innerHTML = `
                    <div class="text-center">
                        <div class="text-6xl mb-4 animate-bounce-custom">‚úÖ</div>
                        <h3 class="text-2xl font-bold text-green-600 mb-2">Benar!</h3>
                        <p class="text-gray-700">${question.explanation}</p>
                    </div>
                `;
            } else {
                feedbackContent.innerHTML = `
                    <div class="text-center">
                        <div class="text-6xl mb-4 animate-shake">‚ùå</div>
                        <h3 class="text-2xl font-bold text-red-600 mb-2">Salah!</h3>
                        <p class="text-gray-700 mb-3">Jawaban yang benar: <strong>${question.correctAnswer}</strong></p>
                        <p class="text-gray-600">${question.explanation}</p>
                    </div>
                `;
            }
            
            document.getElementById('questionCard').classList.add('hidden');
            feedbackCard.classList.remove('hidden');
            
            // Update next button text
            const nextBtn = document.getElementById('nextBtn');
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.textContent = 'Lihat Hasil';
            } else {
                nextBtn.textContent = 'Soal Berikutnya';
            }
        }

        // Next question
        document.getElementById('nextBtn').addEventListener('click', function() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex < questions.length) {
                showQuestion();
            } else {
                showResults();
            }
        });

        function showResults() {
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            const percentage = (correctAnswersCount / questions.length) * 100;
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('correctAnswers').textContent = `${correctAnswersCount} dari ${questions.length}`;
            document.getElementById('totalQuestionsResult').textContent = questions.length;
            
            // Set result icon and appreciation message
            let resultIcon, appreciationMessage;
            
            if (percentage >= 90) {
                resultIcon = 'üèÜ';
                appreciationMessage = 'Luar biasa! Prestasi yang sangat membanggakan!';
                createConfetti();
            } else if (percentage >= 80) {
                resultIcon = 'ü•á';
                appreciationMessage = 'Hebat! Hasil yang sangat baik!';
            } else if (percentage >= 70) {
                resultIcon = 'ü•à';
                appreciationMessage = 'Bagus! Terus tingkatkan lagi!';
            } else if (percentage >= 60) {
                resultIcon = 'ü•â';
                appreciationMessage = 'Cukup baik! Masih bisa lebih baik lagi!';
            } else {
                resultIcon = 'üìö';
                appreciationMessage = 'Tetap semangat! Belajar lagi ya!';
            }
            
            document.getElementById('resultIcon').textContent = resultIcon;
            document.getElementById('appreciationMessage').textContent = appreciationMessage;
            
            // Submit result to Google Sheets
            submitResult();
        }

        function createConfetti() {
            const colors = ['#f39c12', '#e74c3c', '#9b59b6', '#3498db', '#2ecc71'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }, i * 100);
            }
        }

        async function submitResult() {
            if (hasSubmittedResult) return;
            
            try {
                const formData = new FormData();
                formData.append('NIS', currentUser.username);
                formData.append('Absen', currentUser.absen);
                formData.append('NamaLengkap', currentUser.nama);
                formData.append('Kelas', currentUser.kelas);
                formData.append('HasilNilai', score);
                
                const response = await fetch('https://script.google.com/macros/s/AKfycbyy0FYm7Djd8RoyCjGKgXqCAJtO2qpmT4EI7CoiToseDfF-M45TlgG1yng7cJH-7G8pgw/exec', {
                    method: 'POST',
                    body: formData
                });
                
                hasSubmittedResult = true;
                console.log('Hasil berhasil dikirim');
            } catch (error) {
                console.error('Error submitting result:', error);
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initSecurity();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'990084bf1587ce4d',t:'MTc2MDcxMTY4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

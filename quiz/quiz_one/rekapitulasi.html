<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rekapitulasi Skor Siswa</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 32px 16px;
    }

    html {
      height: 100%;
    }

    .container {
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.35);
      width: 100%;
      max-width: 1200px;
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      padding: 40px 32px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: pulse 15s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }

    .header h1 {
      margin: 0 0 16px 0;
      font-size: 36px;
      font-weight: 700;
      position: relative;
      z-index: 1;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .header-subtitle {
      font-size: 16px;
      opacity: 0.95;
      font-weight: 400;
      position: relative;
      z-index: 1;
    }

    .content {
      padding: 40px 32px;
    }

    .controls-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      gap: 16px;
      flex-wrap: wrap;
    }

    .filter-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .filter-label {
      font-weight: 600;
      color: #667eea;
      font-size: 15px;
    }

    .filter-select {
      padding: 10px 16px;
      border: 2px solid #e8ebff;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      background: #ffffff;
      cursor: pointer;
      transition: all 0.2s ease;
      outline: none;
      min-width: 150px;
    }

    .filter-select:hover {
      border-color: #667eea;
    }

    .filter-select:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .count-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }

    .export-btn {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #ffffff;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .export-btn:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
    }

    .export-btn:active {
      transform: translateY(0);
    }

    .export-btn:disabled {
      background: #d1d5db;
      cursor: not-allowed;
      box-shadow: none;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #667eea;
    }

    .spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 18px;
      font-weight: 500;
      color: #667eea;
    }

    .error {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      color: #ffffff;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }

    .info-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      padding: 12px 20px;
      border-radius: 8px;
      margin-bottom: 24px;
      text-align: center;
      font-size: 14px;
      font-weight: 500;
    }

    .stats-bar {
      display: flex;
      justify-content: space-around;
      margin-bottom: 30px;
      gap: 16px;
      flex-wrap: wrap;
    }

    .stat-card {
      background: #ffffff;
      padding: 24px;
      border-radius: 16px;
      flex: 1;
      min-width: 150px;
      text-align: center;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.12);
      border: 2px solid #e8ebff;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }

    .stat-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 32px rgba(102, 126, 234, 0.2);
      border-color: #667eea;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #667eea;
    }

    .table-wrapper {
      overflow-x: auto;
      border-radius: 12px;
      border: 2px solid #e8ebff;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
    }

    thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
    }

    th {
      padding: 18px 16px;
      text-align: left;
      font-weight: 600;
      font-size: 14px !important;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      user-select: none;
      position: relative;
      transition: background 0.2s ease;
      color: #ffffff !important;
    }

    th:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    th::after {
      content: '‚áÖ';
      position: absolute;
      right: 8px;
      opacity: 0.5;
      font-size: 12px;
    }

    th.sort-asc::after {
      content: '‚ñ≤';
      opacity: 1;
    }

    th.sort-desc::after {
      content: '‚ñº';
      opacity: 1;
    }

    tbody tr {
      border-bottom: 1px solid #e8ebff;
      transition: all 0.3s ease;
    }

    tbody tr:hover {
      background: linear-gradient(90deg, #f0f4ff 0%, #ffffff 100%);
      transform: translateX(4px);
      box-shadow: -4px 0 0 0 #667eea, 0 2px 12px rgba(102, 126, 234, 0.15);
    }

    tbody tr:last-child {
      border-bottom: none;
    }

    td {
      padding: 18px 16px;
      font-size: 15px;
      color: #333333;
    }

    .absen-col {
      font-weight: 700;
      color: #667eea;
      width: 100px;
      text-align: center;
    }

    .nama-col {
      font-weight: 600;
      min-width: 200px;
      color: #2d3748;
    }

    .kelas-col {
      color: #718096;
      width: 140px;
      font-weight: 500;
    }

    .skor-col {
      font-weight: 700;
      color: #764ba2;
      text-align: center;
      width: 120px;
      font-size: 18px;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999999;
    }

    .empty-state-icon {
      font-size: 80px;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-state-text {
      font-size: 18px;
      font-weight: 500;
      color: #666;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 26px;
      }

      .content {
        padding: 24px 16px;
      }

      th, td {
        padding: 14px 10px;
        font-size: 13px;
      }

      .nama-col {
        min-width: 150px;
      }

      .stat-card {
        min-width: 120px;
      }

      .stat-value {
        font-size: 24px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <main class="container">
   <header class="header">
    <h1 id="table-title">üéì Laporan Hasil Evaluasi Siswa üìä</h1>
    <p class="header-subtitle">Sistem Rekapitulasi Nilai Berbasis Real-time Database</p>
   </header>
   <div class="content">
    <div id="loading" class="loading">
     <div class="spinner"></div>
     <div class="loading-text" id="loading-text">
      Memuat data dari Firebase...
     </div>
    </div>
    <div id="error" class="error" style="display: none;"></div>
    <div id="table-container" style="display: none;">
     <div class="controls-bar">
      <div class="filter-section"><span class="filter-label">üîç Filter Kelas:</span> <select id="class-filter" class="filter-select"> <option value="all">Semua Kelas</option> </select>
      </div>
      <div style="display: flex; gap: 12px; align-items: center;"><button id="export-excel-btn" class="export-btn"> üìä Export ke Excel </button>
       <div class="count-badge" id="count-badge">
        Total: 0 Siswa
       </div>
      </div>
     </div>
     <div class="stats-bar" id="stats-bar"></div>
     <div class="table-wrapper">
      <table>
       <thead>
        <tr>
         <th class="absen-col">Absen</th>
         <th class="nama-col">Nama</th>
         <th class="kelas-col">Kelas</th>
         <th class="skor-col">Skor</th>
        </tr>
       </thead>
       <tbody id="table-body">
       </tbody>
      </table>
     </div>
    </div>
   </div>
  </main>
  <script>
    const defaultConfig = {
      table_title: "üéì Laporan Hasil Evaluasi Siswa üìä",
      loading_text: "Memuat data dari Firebase...",
      empty_message: "Belum ada data siswa di detail_jawaban",
      primary_color: "#667eea",
      secondary_color: "#764ba2",
      background_color: "#ffffff",
      text_color: "#333333",
      accent_color: "#f8f9ff"
    };

    let config = { ...defaultConfig };

    async function onConfigChange(newConfig) {
      config = { ...config, ...newConfig };
      
      const titleElement = document.getElementById('table-title');
      const loadingTextElement = document.getElementById('loading-text');
      
      if (titleElement) {
        titleElement.textContent = config.table_title || defaultConfig.table_title;
      }
      
      if (loadingTextElement) {
        loadingTextElement.textContent = config.loading_text || defaultConfig.loading_text;
      }
      
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;
      
      document.body.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
      
      const headers = document.querySelectorAll('.header');
      headers.forEach(el => {
        el.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
      });
      
      const theads = document.querySelectorAll('thead');
      theads.forEach(el => {
        el.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
      });
      
      const infoBadge = document.querySelector('.info-badge');
      if (infoBadge) {
        infoBadge.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
      }
      
      const container = document.querySelector('.container');
      if (container) {
        container.style.background = backgroundColor;
      }
      
      const allTextElements = document.querySelectorAll('td:not(.absen-col):not(.skor-col)');
      allTextElements.forEach(el => {
        el.style.color = textColor;
      });
      
      const absenCols = document.querySelectorAll('.absen-col');
      absenCols.forEach(el => {
        if (el.tagName === 'TD') {
          el.style.color = primaryColor;
        }
      });
      
      const skorCols = document.querySelectorAll('.skor-col');
      skorCols.forEach(el => {
        if (el.tagName === 'TD') {
          el.style.color = secondaryColor;
        }
      });
      
      const statValues = document.querySelectorAll('.stat-value');
      statValues.forEach(el => {
        el.style.color = primaryColor;
      });
      
      const rows = document.querySelectorAll('tbody tr');
      rows.forEach(row => {
        row.addEventListener('mouseenter', () => {
          row.style.background = `linear-gradient(90deg, ${accentColor} 0%, ${backgroundColor} 100%)`;
        });
        row.addEventListener('mouseleave', () => {
          row.style.background = '';
        });
      });
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.primary_color || defaultConfig.primary_color,
            set: (value) => {
              config.primary_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ primary_color: value });
              }
            }
          },
          {
            get: () => config.secondary_color || defaultConfig.secondary_color,
            set: (value) => {
              config.secondary_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ secondary_color: value });
              }
            }
          },
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ background_color: value });
              }
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          },
          {
            get: () => config.accent_color || defaultConfig.accent_color,
            set: (value) => {
              config.accent_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ accent_color: value });
              }
            }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["table_title", config.table_title || defaultConfig.table_title],
        ["loading_text", config.loading_text || defaultConfig.loading_text],
        ["empty_message", config.empty_message || defaultConfig.empty_message]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    const firebaseConfig = {
      apiKey: "AIzaSyDAXMd9cAPtkgjo7R4xEZY18IGOJMxsJ3g",
      authDomain: "view-count-1287b.firebaseapp.com",
      databaseURL: "https://view-count-1287b-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "view-count-1287b",
      storageBucket: "view-count-1287b.firebasestorage.app",
      messagingSenderId: "264930996114",
      appId: "1:264930996114:web:6f7b6ed38a73e992529b4b",
      measurementId: "G-99YYF6TG0P"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    function showError(message) {
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      document.getElementById('loading').style.display = 'none';
    }

    function showEmptyState() {
      const tableBody = document.getElementById('table-body');
      const emptyMessage = config.empty_message || defaultConfig.empty_message;
      
      tableBody.innerHTML = `
        <tr>
          <td colspan="4">
            <div class="empty-state">
              <div class="empty-state-icon">üìã</div>
              <div class="empty-state-text">${emptyMessage}</div>
            </div>
          </td>
        </tr>
      `;
      document.getElementById('loading').style.display = 'none';
      document.getElementById('table-container').style.display = 'block';
    }

    function calculateStats(students) {
      const total = students.length;
      const totalScore = students.reduce((sum, s) => sum + (parseFloat(s.skor) || 0), 0);
      const avgScore = total > 0 ? (totalScore / total).toFixed(1) : 0;
      const maxScore = total > 0 ? Math.max(...students.map(s => parseFloat(s.skor) || 0)) : 0;
      
      return { total, avgScore, maxScore };
    }

    function renderStats(stats) {
      const statsBar = document.getElementById('stats-bar');
      statsBar.innerHTML = `
        <div class="stat-card">
          <div class="stat-label">üìö Total Siswa</div>
          <div class="stat-value">${stats.total}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">üìä Rata-rata Skor</div>
          <div class="stat-value">${stats.avgScore}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">üèÜ Skor Tertinggi</div>
          <div class="stat-value">${stats.maxScore}</div>
        </div>
      `;
    }

    let currentStudents = [];
    let allStudents = [];
    let sortColumn = null;
    let sortDirection = 'asc';
    let selectedClass = 'all';

    function sortStudents(column) {
      if (sortColumn === column) {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        sortColumn = column;
        sortDirection = 'asc';
      }

      const sorted = [...currentStudents].sort((a, b) => {
        let valA, valB;

        if (column === 'absen') {
          valA = parseInt(a.absen) || 0;
          valB = parseInt(b.absen) || 0;
        } else if (column === 'skor') {
          valA = parseFloat(a.skor) || 0;
          valB = parseFloat(b.skor) || 0;
        } else if (column === 'nama') {
          valA = (a.nama || '').toLowerCase();
          valB = (b.nama || '').toLowerCase();
        } else if (column === 'kelas') {
          valA = (a.kelas || '').toLowerCase();
          valB = (b.kelas || '').toLowerCase();
        }

        if (valA < valB) return sortDirection === 'asc' ? -1 : 1;
        if (valA > valB) return sortDirection === 'asc' ? 1 : -1;
        return 0;
      });

      updateTableHeaders();
      renderTableRows(sorted);
      
      const stats = calculateStats(sorted);
      renderStats(stats);
    }

    function updateTableHeaders() {
      const headers = document.querySelectorAll('th');
      headers.forEach(th => {
        th.classList.remove('sort-asc', 'sort-desc');
      });

      const columnMap = {
        'absen': 0,
        'nama': 1,
        'kelas': 2,
        'skor': 3
      };

      if (sortColumn && columnMap[sortColumn] !== undefined) {
        const headerIndex = columnMap[sortColumn];
        headers[headerIndex].classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
      }
    }

    function renderTableRows(students) {
      const tableBody = document.getElementById('table-body');
      tableBody.innerHTML = '';

      students.forEach(student => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="absen-col">${student.absen || '-'}</td>
          <td class="nama-col">${student.nama || '-'}</td>
          <td class="kelas-col">${student.kelas || '-'}</td>
          <td class="skor-col">${student.skor !== undefined && student.skor !== null ? student.skor : '-'}</td>
        `;
        tableBody.appendChild(row);
      });

      const countBadge = document.getElementById('count-badge');
      if (countBadge) {
        countBadge.textContent = `Total: ${students.length} Siswa`;
      }
    }

    function setupSortHandlers() {
      const headers = document.querySelectorAll('th');
      const columns = ['absen', 'nama', 'kelas', 'skor'];
      
      headers.forEach((th, index) => {
        th.addEventListener('click', () => {
          sortStudents(columns[index]);
        });
      });
    }

    function populateClassFilter(students) {
      const classes = [...new Set(students.map(s => s.kelas))].sort();
      const classFilter = document.getElementById('class-filter');
      
      classFilter.innerHTML = '<option value="all">Semua Kelas</option>';
      classes.forEach(kelas => {
        if (kelas && kelas !== '-') {
          const option = document.createElement('option');
          option.value = kelas;
          option.textContent = kelas;
          classFilter.appendChild(option);
        }
      });

      classFilter.addEventListener('change', (e) => {
        selectedClass = e.target.value;
        filterAndRenderStudents();
      });
    }

    function filterAndRenderStudents() {
      let filtered = allStudents;
      
      if (selectedClass !== 'all') {
        filtered = allStudents.filter(s => s.kelas === selectedClass);
      }

      currentStudents = filtered;
      
      if (sortColumn) {
        sortStudents(sortColumn);
      } else {
        renderTableRows(filtered);
        const stats = calculateStats(filtered);
        renderStats(stats);
      }
    }

    function exportToExcel() {
      const exportBtn = document.getElementById('export-excel-btn');
      exportBtn.disabled = true;
      exportBtn.textContent = '‚è≥ Mengekspor...';

      try {
        const dataToExport = currentStudents.map((student, index) => ({
          'No': index + 1,
          'Absen': student.absen || '-',
          'Nama': student.nama || '-',
          'Kelas': student.kelas || '-',
          'Skor': student.skor !== undefined && student.skor !== null ? student.skor : '-'
        }));

        const stats = calculateStats(currentStudents);
        const summaryData = [
          {},
          { 'No': 'RINGKASAN STATISTIK' },
          { 'No': 'Total Siswa', 'Absen': stats.total },
          { 'No': 'Rata-rata Skor', 'Absen': stats.avgScore },
          { 'No': 'Skor Tertinggi', 'Absen': stats.maxScore }
        ];

        const allData = [...dataToExport, ...summaryData];

        const ws = XLSX.utils.json_to_sheet(allData);

        const colWidths = [
          { wch: 5 },
          { wch: 10 },
          { wch: 30 },
          { wch: 15 },
          { wch: 10 }
        ];
        ws['!cols'] = colWidths;

        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Data Siswa');

        const filterText = selectedClass === 'all' ? 'Semua_Kelas' : selectedClass.replace(/\s+/g, '_');
        const timestamp = new Date().toISOString().slice(0, 10);
        const filename = `Rekapitulasi_Skor_${filterText}_${timestamp}.xlsx`;

        XLSX.writeFile(wb, filename);

        exportBtn.textContent = '‚úÖ Berhasil!';
        setTimeout(() => {
          exportBtn.textContent = 'üìä Export ke Excel';
          exportBtn.disabled = false;
        }, 2000);
      } catch (error) {
        console.error('Error exporting to Excel:', error);
        exportBtn.textContent = '‚ùå Gagal Export';
        setTimeout(() => {
          exportBtn.textContent = 'üìä Export ke Excel';
          exportBtn.disabled = false;
        }, 2000);
      }
    }

    function renderTable(students) {
      allStudents = students;
      currentStudents = students;
      
      populateClassFilter(students);
      renderTableRows(students);

      const stats = calculateStats(students);
      renderStats(stats);

      document.getElementById('loading').style.display = 'none';
      document.getElementById('table-container').style.display = 'block';
      
      setupSortHandlers();
      
      const exportBtn = document.getElementById('export-excel-btn');
      exportBtn.addEventListener('click', exportToExcel);
      
      onConfigChange(config);
    }

    database.ref('/detail_jawaban').once('value')
      .then(snapshot => {
        const data = snapshot.val();
        
        if (!data) {
          showEmptyState();
          return;
        }

        const students = [];
        
        Object.keys(data).forEach(key => {
          const item = data[key];
          
          if (typeof item === 'object' && item !== null) {
            students.push({
              absen: item.absen || item.no_absen || item.id || key,
              nama: item.nama || item.name || item.student_name || item.nama_siswa || '-',
              kelas: item.kelas || item.class || item.grade || item.kelas_siswa || '-',
              skor: item.skor_persen !== undefined ? item.skor_persen : (item.skor !== undefined ? item.skor : (item.score !== undefined ? item.score : (item.nilai !== undefined ? item.nilai : 0)))
            });
          }
        });

        if (students.length === 0) {
          showEmptyState();
        } else {
          students.sort((a, b) => {
            const absenA = parseInt(a.absen) || 0;
            const absenB = parseInt(b.absen) || 0;
            return absenA - absenB;
          });
          
          renderTable(students);
        }
      })
      .catch(error => {
        console.error('Error fetching data:', error);
        showError('‚ùå Gagal memuat data dari Firebase path "detail_jawaban". Silakan periksa koneksi dan struktur database.');
      });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99cb984be353ca88',t:'MTc2Mjg0MTA5NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>